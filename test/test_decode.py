import json
import unittest
from qsfdecode.jsondecode.surveyobjectdecoder import SurveyObjectDecoder
from qsfdecode.jsondecode.questions import *

SAMC_JSON = '{"SurveyID": "SV_6llqAsI32tDsPSl", "Element": "SQ", "PrimaryAttribute": "QID1", "SecondaryAttribute": "Click to write Question Text", "TertiaryAttribute": null, "Payload": {"QuestionText": "Click to write Question Text", "DataExportTag": "SurveyQuestionName", "QuestionType": "MC", "Selector": "SAVR", "SubSelector": "TX", "Configuration": {"QuestionDescriptionOption": "UseText"}, "QuestionDescription": "Click to write Question Text", "Choices": {"1": {"Display": "Choice1"}, "2": {"Display": "Choice2"}, "3": {"Display": "Choice3"}, "4": {"Display": "TextEntryChoice", "TextEntry": "true", "TextEntryValidation": "ValidUSState"}}, "ChoiceOrder": ["1", "2", "3", "4"], "Validation": {"Settings": {"ForceResponse": "OFF", "ForceResponseType": "ON", "Type": "None"}}, "Language": [], "NextChoiceId": 5, "NextAnswerId": 1, "QuestionID": "QID1", "DataVisibility": {"Private": false, "Hidden": false}}}'

MAMC_JSON = '{"SurveyID": "SV_6llqAsI32tDsPSl", "Element": "SQ", "PrimaryAttribute": "QID17", "SecondaryAttribute": "MC MAVR Both", "TertiaryAttribute": null, "Payload": {"QuestionText": "MC MAVR Both", "DataExportTag": "MC_MAVR_Both", "QuestionType": "MC", "Selector": "MAVR", "SubSelector": "TX", "Configuration": {"QuestionDescriptionOption": "UseText"}, "QuestionDescription": "MC MAVR Both", "Choices": {"1": {"Display": "Click to write Choice 1"}, "2": {"Display": "Click to write Choice 2"}, "3": {"Display": "Click to write Choice 3"}, "4": {"Display": "TextEntryChoice", "TextEntry": "true"}}, "ChoiceOrder": ["1", "2", "3", "4"], "Validation": {"Settings": {"ForceResponse": "OFF", "ForceResponseType": "ON", "Type": "None"}}, "Language": [], "NextChoiceId": 5, "NextAnswerId": 1, "QuestionID": "QID17", "RecodeValues": {"1": "0", "2": "1", "3": "2", "4": "3"}, "DataVisibility": {"Private": false, "Hidden": false}, "VariableNaming": {"1": "MC_MAVR_Both1", "2": "MC_MAVR_Both2", "3": "MC_MAVR_Both3", "4": "MC_MAVR_Both4"}}}'

SAMX_JSON = '{"SurveyID": "SV_6llqAsI32tDsPSl", "Element": "SQ", "PrimaryAttribute": "QID26", "SecondaryAttribute": "M Lik SA RecAll", "TertiaryAttribute": null, "Payload": {"QuestionText": "M Lik SA RecAll", "DefaultChoices": false, "DataExportTag": "M_Lik_SA_RecAll", "QuestionType": "Matrix", "Selector": "Likert", "SubSelector": "SingleAnswer", "Configuration": {"QuestionDescriptionOption": "UseText", "TextPosition": "inline", "ChoiceColumnWidth": 25, "RepeatHeaders": "none", "WhiteSpace": "OFF", "MobileFirst": true}, "QuestionDescription": "M Lik SA RecAll", "Choices": {"1": {"Display": "Click to write Statement 1"}, "2": {"Display": "Click to write Statement 2"}, "3": {"Display": "Click to write Statement 3"}}, "ChoiceOrder": ["1", "2", "3"], "Validation": {"Settings": {"ForceResponse": "OFF", "ForceResponseType": "ON", "Type": "None"}}, "RecodeValues": {"1": "4", "2": "5", "3": "6"}, "VariableNaming": {"1": "ScalePoint.1", "2": "ScalePoint.2", "3": "ScalePoint.3"}, "GradingData": [], "Language": [], "NextChoiceId": 4, "NextAnswerId": 4, "Answers": {"1": {"Display": "Click to write Scale Point 1"}, "2": {"Display": "Click to write Scale Point 2"}, "3": {"Display": "Click to write Scale Point 3"}}, "AnswerOrder": ["1", "2", "3"], "ChoiceDataExportTags": {"1": "M_Lik_SA_QET.1", "2": "M_Lik_SA_QET.2", "3": "M_Lik_SA_Qet.3"}, "QuestionID": "QID26", "DataVisibility": {"Private": false, "Hidden": false}}}'

MAMX_JSON = '{"SurveyID": "SV_6llqAsI32tDsPSl", "Element": "SQ", "PrimaryAttribute": "QID40", "SecondaryAttribute": "M_Likert_MA_RecAll QuestionLabel", "TertiaryAttribute": null, "Payload": {"QuestionText": "M_Likert_MA_RecAll Question Text", "DefaultChoices": false, "DataExportTag": "M_Likert_MA_RecAll", "QuestionType": "Matrix", "Selector": "Likert", "SubSelector": "MultipleAnswer", "Configuration": {"QuestionDescriptionOption": "SpecifyLabel", "TextPosition": "inline", "ChoiceColumnWidth": 25, "RepeatHeaders": "none", "WhiteSpace": "OFF", "MobileFirst": true}, "QuestionDescription": "M_Likert_MA_RecAll QuestionLabel", "Choices": {"1": {"Display": "SubQuestion1"}, "2": {"Display": "SubQuestion2"}, "3": {"Display": "SubQuestion3"}}, "ChoiceOrder": ["1", "2", "3"], "Validation": {"Settings": {"ForceResponse": "OFF", "ForceResponseType": "ON", "Type": "None"}}, "GradingData": [], "Language": [], "NextChoiceId": 4, "NextAnswerId": 4, "Answers": {"1": {"Display": "ScalePoint1"}, "2": {"Display": "ScalePoint2"}, "3": {"Display": "ScalePoint3"}}, "AnswerOrder": ["1", "2", "3"], "ChoiceDataExportTags": {"1": "M_Lik_MA_SubQuestion1", "2": "M_Lik_MA_SubQuestion2", "3": "M_Lik_MA_SubQuestion3"}, "QuestionID": "QID40", "RecodeValues": {"1": "15", "2": "66", "3": "99"}, "VariableNaming": {"1": "VarName1", "2": "VarName2", "3": "VarName3"}, "DataVisibility": {"Private": false, "Hidden": false}}}'

ROQ_JSON = '{"SurveyID": "SV_6llqAsI32tDsPSl", "Element": "SQ", "PrimaryAttribute": "QID33", "SecondaryAttribute": "Rank Order", "TertiaryAttribute": null, "Payload": {"QuestionText": "Rank Order", "DefaultChoices": false, "DataExportTag": "RankOrder", "QuestionType": "RO", "Selector": "DND", "SubSelector": "TX", "Configuration": {"QuestionDescriptionOption": "UseText"}, "QuestionDescription": "Rank Order", "Choices": {"1": {"Display": "Click to write Item 1"}, "2": {"Display": "Click to write Item 2"}, "3": {"Display": "Click to write Item 3"}}, "ChoiceOrder": ["1", "2", "3"], "Validation": {"Settings": {"ForceResponse": "OFF", "Type": "None"}}, "GradingData": [], "Language": [], "NextChoiceId": 4, "NextAnswerId": 1, "QuestionID": "QID33", "DataVisibility": {"Private": false, "Hidden": false}}}'

SBS_JSON = '{"SurveyID": "SV_6llqAsI32tDsPSl", "Element": "SQ", "PrimaryAttribute": "QID37", "SecondaryAttribute": "SBS RecodeAll with text entry column and Multi_answer column", "TertiaryAttribute": null, "Payload": {"QuestionText": "SBS RecodeAll&nbsp; with text entry column and Multi_answer column", "DefaultChoices": false, "DataExportTag": "SBS_RecodeAll", "QuestionType": "SBS", "Selector": "SBSMatrix", "DataVisibility": {"Private": false, "Hidden": false}, "Configuration": {"QuestionDescriptionOption": "UseText", "RepeatHeaders": "none"}, "QuestionDescription": "SBS RecodeAll with text entry column and Multi_answer column", "Choices": {"1": {"Display": "Click to write Statement 1"}, "2": {"Display": "Click to write Statement 2"}, "3": {"Display": "Click to write Statement 3"}}, "ChoiceOrder": ["1", "2", "3"], "Validation": {"Settings": {"ForceResponse": "OFF", "ForceResponseType": "ON", "Type": "None"}}, "GradingData": [], "Language": [], "NextChoiceId": 4, "NextAnswerId": 9, "NumberOfQuestions": 4, "AdditionalQuestions": {"1": {"Answers": {"1": {"Display": "Col1Ans1"}, "2": {"Display": "Col1ANs2"}}, "QuestionText": "Click to write Column 1", "RecodeValues": {"1": "0", "2": "1"}, "VariableNaming": {"1": "C1A1", "2": "C1A2"}, "AnalyzeChoices": [], "AnswerDataExportTag": "Col1Label", "QuestionType": "Matrix", "Selector": "Likert", "SubSelector": "SingleAnswer", "ChoiceColumnWidthPixels": null, "DataExportTag": "SBS_RecodeAll#1", "QuestionID": "QID37#1", "Choices": {"1": {"Display": "Click to write Statement 1"}, "2": {"Display": "Click to write Statement 2"}, "3": {"Display": "Click to write Statement 3"}}, "ChoiceDataExportTags": {"1": "SBS_RecodeAll_1", "2": "SBS_RecodeAll_2", "3": "SBS_RecodeAll_3"}, "QuestionDescription": "Click to write Column 1", "Configuration": {"QuestionDescriptionOption": "UseText"}}, "2": {"Answers": {"1": {"Display": "Col2Ans1"}, "2": {"Display": "Col2Ans2"}}, "QuestionText": "Click to write Column 2", "RecodeValues": {"1": "2", "2": "3"}, "VariableNaming": {"1": "C2A1", "2": "C2A2"}, "AnalyzeChoices": [], "AnswerDataExportTag": "Col2Label", "QuestionType": "Matrix", "Selector": "Likert", "SubSelector": "SingleAnswer", "ChoiceColumnWidthPixels": null, "DataExportTag": "SBS_RecodeAll#2", "QuestionID": "QID37#2", "Choices": {"1": {"Display": "Click to write Statement 1"}, "2": {"Display": "Click to write Statement 2"}, "3": {"Display": "Click to write Statement 3"}}, "ChoiceDataExportTags": {"1": "SBS_RecodeAll_1", "2": "SBS_RecodeAll_2", "3": "SBS_RecodeAll_3"}, "QuestionDescription": "Click to write Column 2", "Configuration": {"QuestionDescriptionOption": "UseText"}}, "3": {"Answers": {"1": {"Display": "Col3Ans1"}, "2": {"Display": "Col3Ans2"}}, "QuestionText": "Click to write Column 3", "RecodeValues": {"1": "4", "2": "5"}, "VariableNaming": {"1": "C3A1", "2": "C3A2"}, "AnalyzeChoices": [], "AnswerDataExportTag": "Col3Label", "QuestionType": "Matrix", "Selector": "Likert", "SubSelector": "MultipleAnswer", "ChoiceColumnWidthPixels": null, "DataExportTag": "SBS_RecodeAll#3", "QuestionID": "QID37#3", "Choices": {"1": {"Display": "Click to write Statement 1"}, "2": {"Display": "Click to write Statement 2"}, "3": {"Display": "Click to write Statement 3"}}, "ChoiceDataExportTags": {"1": "SBS_RecodeAll_1", "2": "SBS_RecodeAll_2", "3": "SBS_RecodeAll_3"}, "QuestionDescription": "Click to write Column 3", "Configuration": {"QuestionDescriptionOption": "UseText"}}, "4": {"Answers": {"1": {"Display": "Col4Ans1"}, "2": {"Display": "Col4Ans2"}}, "QuestionText": "TextEntryColumn", "RecodeValues": {"1": "6", "2": "7"}, "VariableNaming": {"1": "C4A1", "2": "C4A2"}, "AnalyzeChoices": [], "AnswerDataExportTag": "Col4Label", "QuestionType": "Matrix", "Selector": "TE", "SubSelector": "Medium", "ChoiceColumnWidthPixels": null, "DataExportTag": "SBS_RecodeAll#4", "QuestionID": "QID37#4", "Choices": {"1": {"Display": "Click to write Statement 1"}, "2": {"Display": "Click to write Statement 2"}, "3": {"Display": "Click to write Statement 3"}}, "ChoiceDataExportTags": {"1": "SBS_RecodeAll_1", "2": "SBS_RecodeAll_2", "3": "SBS_RecodeAll_3"}, "QuestionDescription": "TextEntryColumn", "Configuration": {"QuestionDescriptionOption": "UseText"}}}, "ChoiceDataExportTags": {"1": "SBS_RecodeAll_1", "2": "SBS_RecodeAll_2", "3": "SBS_RecodeAll_3"}, "QuestionID": "QID37", "RecodeValues": {"1": "1", "2": "2", "3": "3", "4": "4"}, "VariableNaming": {"1": ["C1A1", "C1A2"], "2": ["C2A1", "C2A2"], "3": ["C3A1", "C3A2"], "4": ["C4A1", "C4A2"]}}}'

TE_JSON = '{"SurveyID": "SV_6llqAsI32tDsPSl", "Element": "SQ", "PrimaryAttribute": "QID30", "SecondaryAttribute": "TextEntry CharRange", "TertiaryAttribute": null, "Payload": {"QuestionText": "TextEntry CharRange", "DefaultChoices": false, "DataExportTag": "TextEntry_CharRange", "QuestionType": "TE", "Selector": "SL", "Configuration": {"QuestionDescriptionOption": "UseText"}, "QuestionDescription": "TextEntry CharRange", "Validation": {"Settings": {"ForceResponse": "OFF", "ForceResponseType": "ON", "Type": "CharRange", "MinChars": "1", "TotalChars": "10"}}, "GradingData": [], "Language": [], "NextChoiceId": 4, "NextAnswerId": 1, "SearchSource": {"AllowFreeResponse": "false"}, "QuestionID": "QID30", "DataVisibility": {"Private": false, "Hidden": false}}}'


class DecoderTest(unittest.TestCase):

    def test_question_decode(self):

        # Test that single answer MC question is decoded correctly
        self.assertIsInstance(json.loads(SAMC_JSON, cls=SurveyObjectDecoder), MultiChoiceQuestion)

        # Test that multi answer MC question is decoded correctly
        self.assertIsInstance(json.loads(MAMC_JSON, cls=SurveyObjectDecoder), MultiAnswerMultiChoiceQuestion)

        # Test that SA matrix question is decoded correctly
        self.assertIsInstance(json.loads(SAMX_JSON, cls=SurveyObjectDecoder), MatrixQuestion)

        # Test that MA matrix question is decoded correctly
        self.assertIsInstance(json.loads(MAMX_JSON, cls=SurveyObjectDecoder), MultiAnswerMatrixQuestion)

        # Test that Rank Order question is decoded correctly
        self.assertIsInstance(json.loads(ROQ_JSON, cls=SurveyObjectDecoder), RankOrderQuestion)

        # Test that SBS question is decoded correctly
        self.assertIsInstance(json.loads(SBS_JSON, cls=SurveyObjectDecoder), SideBySideQuestion)

        # Test that TextEntry question is decoded correctly
        self.assertIsInstance(json.loads(TE_JSON, cls=SurveyObjectDecoder), TextEntryQuestion)
